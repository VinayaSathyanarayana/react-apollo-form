(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1000:function(e,t,r){"use strict";var n=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e};Object.defineProperty(t,"__esModule",{value:!0});var o=r(204),i=r(72),a=r(1519);t.isMutationConfig=function(e){return!!o.get(e,"mutation")&&o.get(e,"mutation.name")},t.flattenSchemaProperties=function(e){return o.transform(e.properties,function(t,r,n){return o.get(r,"$ref")?t[n]=i.retrieveSchema(r,e.definitions):t[n]=r,t},{})};var s=function(e,t){return function(r,i,a){var u,c=o.get(e,a),l=o.last(a.split("."));return c&&c["ui:if"]?0===o.filter(c["ui:if"],function(e,r){var n=o.get(t,r);return e&&e!==n}).length&&Object.assign(r,i):o.has(i,"properties")?(Object.assign(r,((u={})[l]=n({type:"object",properties:{}},i.required?{required:i.required}:{}),u)),o.map(i.properties,function(n,o){r[l].properties[o]=s(e,t)({},n,a+"."+o)})):Object.assign(r,i),r}};t.applyConditionsToSchema=function(e,t,r){var n=o.cloneDeep(e);return n.properties?Object.assign({},n,{properties:o.transform(n.properties,s(t,r),{})}):n},t.getSchemaFromConfig=function(e,r,n){var i;if(t.isMutationConfig(r)){var s=a.ApolloFormBuilder.getMutationConfig(e,r.mutation.name);i=a.ApolloFormBuilder.getSchema(e,s.properties,s.required)}else i=a.ApolloFormBuilder.getSchema(e,r.schema.properties||{});var u=o.cloneDeep(Object.assign({},i,{properties:t.flattenSchemaProperties(i)}));return r.ignoreFields&&r.ignoreFields.map(function(e){o.unset(u.properties,e.replace(/\./g,".properties."))}),r.updateFields&&o.map(r.updateFields,function(e,t){var r=t.replace(/\./g,".properties.");o.set(u.properties,r,o.merge(o.get(u.properties,r),e))}),r.requiredFields&&o.map(r.requiredFields,function(e){var t=e.split("."),r=o.last(t),n=o.take(t,t.length-1).join(".").replace(/\./g,".properties."),i=o.uniq(o.get(u.properties,n+".required").concat([r]));o.set(u.properties,n+".required",i)}),r.augment&&(u=o.merge({},u,r.augment)),u},t.transformErrors=function(e){return function(t){return t.map(function(t){return n({},t,{message:"FormError."+e+t.property+"."+t.name})})}},t.cleanData=function(e,r,n){return void 0===n&&(n=null),o.transform(e,function(e,i,a){var s=n?n+"."+a:a;return o.has(r,s.replace(/\./g,".properties."))&&(o.isPlainObject(i)?e[a]=t.cleanData(i,r,s):e[a]=i),e},{})},t.isTruthyWithDefault=function(e,t){return void 0===t&&(t=!0),o.isUndefined(e)?t:!!e}},1519:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(204),o={exclude:["id"]};!function(e){e.filterProperties=function(e,t,r){return void 0===r&&(r="exclusive"),"exclusive"===r?n.omit(e,t):n.pick(e,t)},e.getMutationConfig=function(t,r,i){void 0===i&&(i=o);var a=t.properties.Mutation.properties[r];if(a){var s=a.properties.arguments;return s?{properties:e.filterProperties(n.reduce(s.properties,function(e,t,r){return e[r]=t,e},{}),i.exclude,"exclusive"),required:a.required.filter(function(e){return!(i.exclude||[]).includes(e)})}:(console.error("mutation "+r+" has no arguments"),{})}return console.error("unknown mutation "+r),{}},e.getSchema=function(e,t,r){return void 0===r&&(r=[]),{type:"object",properties:t,required:r,definitions:e.definitions||{}}}}(t.ApolloFormBuilder||(t.ApolloFormBuilder={}))},1591:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e};Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=r(289),u=r(289),c=r(289),l=r(289),p=r(289),d=r(1e3);t.getTheme=function(e){return{templates:e&&e.templates?e.templates:{},fields:e&&e.fields?e.fields:{},widgets:e&&e.widgets?e.widgets:{},renderers:{buttons:e&&e.renderers&&e.renderers.buttons?e.renderers.buttons:s.buttonsRenderer,cancelButton:e&&e.renderers&&e.renderers.cancelButton?e.renderers.cancelButton:u.cancelButtonRenderer,saveButton:e&&e.renderers&&e.renderers.saveButton?e.renderers.saveButton:p.saveButtonRenderer,header:e&&e.renderers&&e.renderers.header?e.renderers.header:l.titleRenderer}}},t.configure=function(e){var r=e.jsonSchema,n=t.getTheme(e.theme);return function(t){function s(){var r=null!==t&&t.apply(this,arguments)||this;return r.state={isDirty:!1,isSaved:!1,hasError:!1,schema:{},schemaWithConditionals:{},data:{}},r.save=function(t){var n=t.formData,o=r.props,a=o.config,s=o.onSave;if(d.isMutationConfig(a)){var u=a.mutation,c=u.document,l=u.variables,p=u.context,m=u.refetchQueries,f=d.cleanData(n,r.state.schema.properties||{});e.client.mutate({mutation:c,refetchQueries:m,variables:i({},f,l||{}),context:p}).then(function(){r.setState(function(){return{isDirty:!1,isSaved:!0,hasError:!1}}),s&&s(f)})}else a.saveData(n)},r.cancel=function(){var e=r.props;e.onCancel&&e.onCancel()},r.onChange=function(e){var t=d.applyConditionsToSchema(r.state.schema,r.props.ui,e.formData);r.setState(function(){return{isDirty:!0,data:d.cleanData(e.formData,t.properties),schemaWithConditionals:t,hasError:e.errors.length>0,isSaved:!1}})},r.simulateSubmit=function(){r.submitBtn&&r.submitBtn.click()},r.childrenProps=function(){return{header:function(){return n.renderers.header({title:r.props.title||"Form"})},form:r.renderForm,buttons:function(){return n.renderers.buttons({cancelButtonRenderer:n.renderers.cancelButton,saveButtonRenderer:n.renderers.saveButton,cancel:r.cancel,save:r.simulateSubmit,hasError:r.state.hasError,isSaved:r.state.isSaved,isDirty:r.state.isDirty})},saveButton:function(){return n.renderers.saveButton({save:r.simulateSubmit,hasError:r.state.hasError,isDirty:r.state.isDirty,isSaved:r.state.isSaved})},cancelButton:function(){return n.renderers.cancelButton({cancel:r.cancel})},cancel:r.cancel,save:r.simulateSubmit,data:r.state.data,isDirty:r.state.isDirty,isSaved:r.state.isSaved,hasError:r.state.hasError}},r.renderLayout=function(){r.props;var e=r.childrenProps(),t=e.buttons,n=e.header,o=e.form;return a.createElement("div",null,n(),o(),t())},r.renderForm=function(){return a.createElement(c.FormRenderer,{theme:n,onChange:r.onChange,save:r.save,transformErrors:d.transformErrors,config:r.props.config,ui:r.props.ui,liveValidate:r.props.liveValidate,schema:r.state.schemaWithConditionals,data:r.state.data,subTitle:r.props.subTitle,isDirty:r.state.isDirty},a.createElement("input",{type:"submit",style:{display:"none"},ref:function(e){return r.submitBtn=e}}))},r}return o(s,t),s.prototype.componentDidMount=function(){var e=this,t=d.getSchemaFromConfig(r,this.props.config,this.props.title);this.setState(function(){return{schema:t,data:e.props.data,schemaWithConditionals:d.applyConditionsToSchema(t,e.props.ui,e.state.data)}})},s.prototype.componentDidUpdate=function(e){var t=this,n=this.props.config,o=e.config;n&&d.isMutationConfig(n)&&n.mutation&&(d.isMutationConfig(o)&&o.mutation?n.mutation.name!==o.mutation.name&&this.setState({schema:d.getSchemaFromConfig(r,n,this.props.title)},function(){return t.setState({schemaWithConditionals:d.applyConditionsToSchema(t.state.schema,t.props.ui,t.state.data)})}):this.setState({schema:d.getSchemaFromConfig(r,n,this.props.title)},function(){return t.setState({schemaWithConditionals:d.applyConditionsToSchema(t.state.schema,t.props.ui,t.state.data)})}))},s.prototype.render=function(){var e=this.props.children;return e?e(this.childrenProps()):this.renderLayout()},s}(a.Component)}},1602:function(e,t,r){"use strict";(function(e){var n=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};Object.defineProperty(t,"__esModule",{value:!0});var o,i=r(402),a=r(37),s=r(1601),u=r(1597),c=r(204),l=r(0),p=r(1033),d=r(401),m=r(1591),f=r(1083),h=f.Button,v=f.Input,g=f.Checkbox,y=f.Header,b=f.Form,S=f.Message,E=r(1372),T=E.withKnobs,C=E.select,_=E.boolean,O=a.graphqlSync(d.schema,a.introspectionQuery).data,D=s.fromIntrospectionQuery(O),j=u.default(o||(o=n(["\n    mutation createTodo($todo: TodoInputType!) {\n        create_todo(todo: $todo) {\n            id\n        }\n    }\n"],["\n    mutation createTodo($todo: TodoInputType!) {\n        create_todo(todo: $todo) {\n            id\n        }\n    }\n"]))),w=function(e){return l.createElement(S,{error:!0,visible:!0,header:"There was some errors",list:e.errors.map(function(e){return e.message})})},F={templates:{FieldTemplate:function(e){e.classNames,e.help;var t=e.description,r=(e.errors,e.children),n=(e.rawErrors,e.label);return l.createElement(b.Field,null,l.createElement("label",null,n,e.required&&"*"),r,l.createElement("span",null,t))},ObjectFieldTemplate:function(e){return l.createElement("div",null,e.properties.map(function(e){return e.content}))}},fields:{StringField:function(e){return l.createElement(v,{value:e.formData,onChange:function(t){return e.onChange(t.currentTarget.value)}})},BooleanField:function(e){return l.createElement(g,{label:e.title,checked:e.formData,onChange:function(t,r){e.onChange(r.checked)}})}},renderers:{saveButton:function(e){return l.createElement(h,{onClick:e.save,primary:!0},"Save")},cancelButton:function(e){return l.createElement(h,{onClick:e.cancel},"Cancel")},header:function(e){return l.createElement(y,{as:"h1"},e.title)}}};i.storiesOf("ApolloForm",e).addDecorator(T).add("default forms",function(){return l.createElement(p.ApolloConsumer,null,function(e){var t=_("withTheme",!0),r=_("liveValidate",!1),n=_("showErrorsList",!0),o=m.configure({client:e,jsonSchema:D,theme:t?F:void 0}),i=c.keys(D.properties.Mutation.properties),a=C("Mutation",i,"create_todo");return l.createElement(o,{title:"Todo Form",liveValidate:r,config:{mutation:{name:a,document:j}},data:{},ui:{showErrorsList:n,errorListComponent:w,todo:{name:{"ui:label":"Task name"},completed:{"ui:label":"is task completed?"}}}},function(e){return l.createElement(b,null,l.createElement("div",{style:{padding:"20px"}},e.header(),e.form(),e.buttons(),JSON.stringify(e.data)))})})}).add("with conditionals",function(){return l.createElement(p.ApolloConsumer,null,function(e){var t=_("withTheme",!0),r=_("liveValidate",!1),n=_("showErrorsList",!0),o=m.configure({client:e,jsonSchema:D,theme:t?F:void 0});return l.createElement(o,{title:"Todo Form",liveValidate:r,config:{name:"todo",schema:{type:"object",properties:{shipping:{type:"object",properties:{billingSameAsDelivery:{type:"boolean"},billing:{type:"object",properties:{address:{type:"string"}}}}}}},saveData:function(e){console.log("save !",e)}},data:{},ui:{showErrorsList:n,errorListComponent:w,shipping:{billing:{"ui:if":{"shipping.billingSameAsDelivery":!0}}}}},function(e){return l.createElement(b,null,l.createElement("div",{style:{padding:"20px"}},e.header(),e.form(),e.buttons(),JSON.stringify(e.data)))})})})}).call(this,r(100)(e))},1603:function(e,t,r){var n={"./index.tsx":1602};function o(e){var t=i(e);return r(t)}function i(e){var t=n[e];if(!(t+1)){var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}return t}o.keys=function(){return Object.keys(n)},o.resolve=i,e.exports=o,o.id=1603},1697:function(e,t,r){"use strict";r.r(t),function(e){var t=r(402),n=r(401),o=r(1079),i=r.n(o),a=(r(1605),r(1603));Object(t.addDecorator)(i()({typeDefs:n.schemaString,mocks:n.mocks})),Object(t.configure)(function(){a.keys().forEach(function(e){return a(e)})},e)}.call(this,r(1039)(e))},1699:function(e,t,r){r(761),r(1698),e.exports=r(1697)},289:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e};Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=r(1590),u=r(1e3);t.titleRenderer=function(e){var t=e.title;return a.createElement("h2",null,t)},t.saveButtonRenderer=function(e){return a.createElement("button",{disabled:!!e.hasError||!e.isDirty,onClick:e.save},e.isSaved?"Saved":"Save")},t.cancelButtonRenderer=function(e){return a.createElement("button",{type:"button",onClick:e.cancel},"Close")},t.buttonsRenderer=function(e){return a.createElement("div",null,e.cancelButtonRenderer({cancel:e.cancel}),e.saveButtonRenderer({save:e.save,isSaved:e.isSaved,isDirty:e.isDirty,hasError:e.hasError}))};var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.render=function(){var e=this.props,t={subTitle:e.subTitle,isDirty:e.isDirty,showErrorsInline:u.isTruthyWithDefault(!e.ui||e.ui.showErrorsInline,!0),formPrefix:e.config.name?e.config.name:u.isMutationConfig(e.config)?e.config.mutation.name:e.config.name};return a.createElement(s.default,i({liveValidate:u.isTruthyWithDefault(e.liveValidate,!1),schema:e.schema,uiSchema:e.ui||{},widgets:e.theme.widgets,formContext:t,fields:e.theme.fields,formData:e.data,onSubmit:e.save,onChange:e.onChange,ArrayFieldTemplate:e.theme.templates.ArrayFieldTemplate,FieldTemplate:e.theme.templates.FieldTemplate,ObjectFieldTemplate:e.theme.templates.ObjectFieldTemplate,showErrorList:u.isTruthyWithDefault(!!e.ui&&e.ui.showErrorsList,!1)},{ErrorList:e.ui?e.ui.errorListComponent:void 0},{transformErrors:e.transformErrors(t.formPrefix)}),this.props.children)},t}(a.Component);t.FormRenderer=c},401:function(e,t,r){"use strict";r.r(t),r.d(t,"mocks",function(){return o}),r.d(t,"schemaString",function(){return i}),r.d(t,"schema",function(){return a});var n=r(37);const o={Query:()=>({todos:()=>[{id:1,name:"Todo #1",completed:!1},{id:2,name:"Todo #2",completed:!1},{id:3,name:"Todo #3",completed:!1}]}),Mutation:()=>({create_todo:(e,t)=>{console.log("create_todo()",t)}})},i="\n        type Todo {\n            id: String!\n            name: String!\n            completed: Boolean\n        }\n\n        input TodoInputType {\n            name: String!\n            completed: Boolean\n        }\n\n        type Query {\n            todo(id: String!): Todo!\n            todos: [Todo!]!\n        }\n\n        type Mutation {\n            update_todo(id: String!, todo: TodoInputType!): Todo\n            create_todo(todo: TodoInputType!): Todo\n        }\n",a=Object(n.buildSchema)(i)}},[[1699,1,2]]]);
//# sourceMappingURL=preview.c98f0a76fdc424415642.bundle.js.map